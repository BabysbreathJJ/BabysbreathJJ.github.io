<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      H5上传图片 | 阿菁菁菁菁菁
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="阿菁菁菁菁菁">
    
    

    <meta name="description" content="H5上传图片">
<meta property="og:type" content="article">
<meta property="og:title" content="H5上传图片 | 阿菁菁菁菁菁">
<meta property="og:url" content="http://lijingjing.top/blog/2016/02/25/H5上传图片/index.html">
<meta property="og:site_name" content="阿菁菁菁菁菁">
<meta property="og:description" content="H5上传图片">
<meta property="og:updated_time" content="2016-04-13T06:16:23.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="H5上传图片 | 阿菁菁菁菁菁">
<meta name="twitter:description" content="H5上传图片">

    
    
      <link rel="icon" type="image/x-icon" href="/images/avatar.png">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    
      <header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">


    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        
        <a href="/" title="link to homepage for 阿菁菁菁菁菁"><img src="/images/avatar.png" width="100" alt="阿菁菁菁菁菁 logo" class="panel-cover__logo logo" /></a>
        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">阿菁菁菁菁菁</a></h1>
        <hr class="panel-cover__divider" />

        
        <h2 class="panel-cover__description panel-description">
          Change takes time.
        </h2>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">


        <nav class="cover-navigation cover-navigation--primary">
          <ul class="navigation">
            
              
              <li class="navigation__item"><a href="/blog" title="" class="blog-button">文章</a></li>
            
              
              <li class="navigation__item"><a href="/archive" title="" class="">归档</a></li>
            
              
              <li class="navigation__item"><a href="/about" title="" class="">关于我</a></li>
            

          </ul>
        </nav>

      <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



<nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
      <!-- Github -->
      <li class="navigation__item">
        <a href="https://github.com/BabysbreathJJ" title="阿菁 on GitHub">
          <i class='icon icon-social-github'></i>
          <span class="label">GitHub</span>
        </a>
      </li>
      <li class="navigation__item">
        <a href="mailto:lijingjing1008@gmail.com" title="阿菁‘s e-mail">
          <i class='icon icon-mail'></i>
          <span class="label">Mail</span>
        </a>
      </li>
      <li class="navigation__item">
        <a href="http://weibo.com/2797656002/profile" title="阿菁 on Weibo">
          <i class='icon cs-icon-weibo'></i>
          <span class="label">Weibo</span>
        </a>
      </li>
    

    <!-- China social icon -->
    <!--

      <li class="navigation__item">
        <a href="" title="">
          <i class='icon cs-icon-douban'></i>
          <span class="label">Douban</span>
        </a>
      </li>



    -->



  </ul>
</nav>




        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    


    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">

    <h1 class="post-title">H5上传图片</h1>

    

    <div class="post-meta">
      <time datetime="2016-02-25" class="post-meta__date date">2016-02-25</time>

      <span class="post-meta__tags tags">
          
            <font class="categories">
            &#8226; 分类:
            <a class="categories-link" href="/categories/前端/">前端</a>
            </font>
          

          
             &#8226; 标签:
            <font class="tags">
              <a class="tags-link" href="/tags/H5/">H5</a>, <a class="tags-link" href="/tags/拍照上传/">拍照上传</a>
            </font>
          
        </span>
     </div>
    

  </header>

  <section id="post-content" class="article-content post">
    <h1 id="我的碎碎念"><a href="#我的碎碎念" class="headerlink" title="我的碎碎念"></a>我的碎碎念</h1><p> 其实H5读取文件什么的还是很方便的吧。<br> 问题一：我觉着利用H5来读取图片文件没什么问题，网上的代码一搜一大把，但是最神烦的是手机拍照后上传图片，因为手机的摄像头方向不是你看到的正着的，它的角度有问题啊。。。你的手机是自己把照片的角度旋转后展现给你的，所以如果你直接拍照后，将刚拍的照片当做上传的图片，你存到后台的图片是侧着的，或者倒着的，看你拍照时候摄像头的方向吧。。。然后项目中还要图片剪裁，所以说先剪裁还是先旋转这个问题我纠结好久，最后发现还是先旋转后剪裁吧，因为用的别人的插件，先剪裁后旋转，没有成功。。<br> 问题二：然后，前几天做web应用的图片上传，因为后台上传图片的接口早写好了，是一个上传文件的统一接口，所以我不能直接传base64过去，后台不支持我的数据格式，后台接收的数据格式是<code>content-tyle=multipart/*</code>，这个是什么格式呢，google之后发现以FormData的形式传到后台是可以的。就是要传一个file过去，base64的话传过去的是String吧。</p>
<h1 id="移动应用拍照上传图片"><a href="#移动应用拍照上传图片" class="headerlink" title="移动应用拍照上传图片"></a>移动应用拍照上传图片</h1><h2 id="库-工具"><a href="#库-工具" class="headerlink" title="库/工具"></a>库/工具</h2><ol>
<li><a href="https://github.com/exif-js/exif-js" target="_blank" rel="external">exif.js</a>,读取图片元信息，获取照片本身的Orientation</li>
<li><a href="https://github.com/stomita/ios-imagefile-megapixel" target="_blank" rel="external">megapix-image.js</a>，来进行图片最终的旋转，按照orientation来写入图片数据</li>
<li><a href="https://github.com/scottcheng/cropit" target="_blank" rel="external">cropit.js</a>，图片剪裁的插件</li>
</ol>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="HTML代码"><a href="#HTML代码" class="headerlink" title="HTML代码"></a>HTML代码</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"display-ib per60 tc"</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"head-logo"</span></span></div><div class="line">                           <span class="attr">class</span>=<span class="string">"bg-gray displayImg tc display-ib pos-r img-circle w-80 ht80 l-ht80 border border-purple vertical-a-m cursor-p overflow-h"</span>&gt;上传头像<span class="tag">&lt;/<span class="name">label</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"head-logo"</span> <span class="attr">class</span>=<span class="string">"top-200 pos-a"</span> <span class="attr">accept</span>=<span class="string">"image/*"</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">id</span>=<span class="string">"imgUrl"</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"cvs"</span> <span class="attr">style</span>=<span class="string">"display: none"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></div><div class="line"></div><div class="line">                   <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"image-editor"</span>&gt;</span></div><div class="line">                       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"cropit-image-preview"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">                       <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"image-size-label"</span>&gt;</span></div><div class="line">                           滑动调整图片大小</div><div class="line">                       <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">                       <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"range"</span> <span class="attr">class</span>=<span class="string">"cropit-image-zoom-input"</span></span></div><div class="line">                              <span class="attr">style</span>=<span class="string">"width: 80%;margin: 10px auto;text-align: center"</span>&gt;</div><div class="line">                       <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn-sm btn-default btn-warning export mr25"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span></span></div><div class="line">                               <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-scissors mr10"</span>&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>裁剪<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                       <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn-sm btn-black mt10 cancelImage"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span></span></div><div class="line">                               <span class="attr">class</span>=<span class="string">"glyphicon glyphicon-remove mr10"</span>&gt;<span class="tag">&lt;/<span class="name">span</span>&gt;</span>取消<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"font-red ml10 display-n"</span>&gt;</span>这里是错误信息<span class="tag">&lt;/<span class="name">span</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">span</span>&gt;</span></div></pre></td></tr></table></figure>
<p>因为在使用megapix-image.js的时候需要使用canvas来获取旋转后的图片，之后传到后台，所以在Html文件中，放了一个隐藏的<code>&lt;canvas&gt;</code>。</p>
<h2 id="JS代码"><a href="#JS代码" class="headerlink" title="JS代码"></a>JS代码</h2><h3 id="为-lt-input-type-39-file-39-gt-添加监听器。"><a href="#为-lt-input-type-39-file-39-gt-添加监听器。" class="headerlink" title="为&lt;input type=&#39;file&#39;/&gt;添加监听器。"></a>为<code>&lt;input type=&#39;file&#39;/&gt;</code>添加监听器。</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">displayImg</span>(<span class="params">result</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> file = <span class="built_in">document</span>.getElementById(<span class="string">'head-logo'</span>);</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> FileReader === <span class="string">'undefined'</span>) &#123;</div><div class="line">        result.innerHTML = <span class="string">"抱歉，你的浏览器不支持 FileReader"</span>;</div><div class="line">        input.setAttribute(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        file.addEventListener(<span class="string">'change'</span>, readFile, <span class="literal">false</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="读取文件"><a href="#读取文件" class="headerlink" title="读取文件"></a>读取文件</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFile</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> file = <span class="keyword">this</span>.files[<span class="number">0</span>];</div><div class="line">    $(<span class="string">'.image-editor'</span>).show();</div><div class="line">    <span class="keyword">if</span> (file) &#123;</div><div class="line">        <span class="comment">//验证图片文件类型</span></div><div class="line">        <span class="keyword">if</span> (file.type &amp;&amp; !<span class="regexp">/image/i</span>.test(file.type)) &#123;</div><div class="line">            alert(<span class="string">"文件必须为图片！"</span>);</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</div><div class="line">        reader.readAsDataURL(file);</div><div class="line">        reader.onload = <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</div><div class="line"></div><div class="line">            render(file, <span class="keyword">this</span>.result);<span class="comment">//旋转图片逻辑</span></div><div class="line">            <span class="comment">//readAsDataURL后执行onload，进入图片压缩逻辑</span></div><div class="line">            <span class="comment">//e.target.result得到的就是图片文件的base64 string</span></div><div class="line">            $(<span class="string">'.export'</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">              <span class="comment">//imageData现在拿到的是旋转过的图片信息</span></div><div class="line">                <span class="keyword">var</span> imageData = $(<span class="string">'.image-editor'</span>).cropit(<span class="string">'export'</span>);</div><div class="line">                <span class="keyword">var</span> img = $(<span class="string">'&lt;img  id="imgsrc" width="80" height="80"&gt;'</span>);</div><div class="line">                img.attr(<span class="string">"src"</span>, imageData);</div><div class="line">                $(<span class="string">".displayImg"</span>).html(img);</div><div class="line">                $(<span class="string">"#imgUrl"</span>).val(imageData.split(<span class="string">","</span>)[<span class="number">1</span>]);</div><div class="line"></div><div class="line">                $(<span class="string">".image-editor"</span>).hide();</div><div class="line">            &#125;);</div><div class="line">            <span class="keyword">var</span> result = <span class="keyword">this</span>.result;</div><div class="line">            <span class="keyword">var</span> img = <span class="keyword">new</span> Image();</div><div class="line">            img.src = result;</div><div class="line">            img.width = <span class="number">80</span>;</div><div class="line">            img.height = <span class="number">80</span>;</div><div class="line">            $(<span class="string">".displayImg"</span>).html(img);</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="利用Exif-js和megapix-image-js进行图片信息获取，和根据图片orientation来进行图片旋转。"><a href="#利用Exif-js和megapix-image-js进行图片信息获取，和根据图片orientation来进行图片旋转。" class="headerlink" title="利用Exif.js和megapix-image.js进行图片信息获取，和根据图片orientation来进行图片旋转。"></a>利用Exif.js和megapix-image.js进行图片信息获取，和根据图片orientation来进行图片旋转。</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//定义照片的最大高度</span></div><div class="line"><span class="keyword">var</span> MAX_HEIGHT = <span class="number">480</span>;</div><div class="line"><span class="keyword">var</span> render = <span class="function"><span class="keyword">function</span> (<span class="params">file, src</span>) </span>&#123;</div><div class="line">    EXIF.getData(file, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="comment">//获取照片本身的Orientation</span></div><div class="line">        <span class="keyword">var</span> orientation = EXIF.getTag(<span class="keyword">this</span>, <span class="string">"Orientation"</span>);</div><div class="line">        <span class="keyword">var</span> image = <span class="keyword">new</span> Image();</div><div class="line">        image.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="comment">//image.src = src;</span></div><div class="line">            <span class="keyword">var</span> cvs = <span class="built_in">document</span>.getElementById(<span class="string">"cvs"</span>);</div><div class="line">            <span class="keyword">var</span> w = image.width;</div><div class="line">            <span class="keyword">var</span> h = image.height;</div><div class="line">            <span class="comment">//计算压缩后的图片长和宽</span></div><div class="line">            <span class="keyword">if</span> (h &gt; MAX_HEIGHT) &#123;</div><div class="line">                w *= MAX_HEIGHT / h;</div><div class="line">                h = MAX_HEIGHT;</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//使用MegaPixImage封装照片数据</span></div><div class="line">            <span class="keyword">var</span> mpImg = <span class="keyword">new</span> MegaPixImage(image);</div><div class="line">            <span class="comment">//按照Orientation来写入图片数据，回调函数是上传图片到服务器</span></div><div class="line">            mpImg.render(cvs, &#123;maxWidth: w, maxHeight: h, orientation: orientation&#125;, sendImg);</div><div class="line">        &#125;;</div><div class="line">        image.src = src;</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> sendImg = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> cvs = <span class="built_in">document</span>.getElementById(<span class="string">"cvs"</span>);</div><div class="line">    <span class="comment">//调用Canvas的toDataURL接口，得到的是照片文件的base64编码string</span></div><div class="line">    <span class="keyword">var</span> data = cvs.toDataURL(<span class="string">"image/jpeg"</span>);</div><div class="line">    <span class="comment">//base64 string过短显然就不是正常的图片数据了，过滤。</span></div><div class="line">    <span class="keyword">if</span> (data.length &lt; <span class="number">48</span>) &#123;</div><div class="line">        <span class="built_in">console</span>.log(<span class="string">"data error."</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    $(<span class="string">'.image-editor'</span>).cropit(<span class="string">'imageSrc'</span>, data);<span class="comment">//裁剪的是旋转过的图片</span></div><div class="line"></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h3 id="上传图片到服务器"><a href="#上传图片到服务器" class="headerlink" title="上传图片到服务器"></a>上传图片到服务器</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> uploadImg = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> uploadUrl = <span class="string">"服务器地址"</span>;</div><div class="line">            <span class="keyword">var</span> uploadData = &#123;</div><div class="line">                <span class="string">'phoneId'</span>: phone,</div><div class="line">                <span class="string">'imageValue'</span>: $(<span class="string">"#imgUrl"</span>).val()</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> ($(<span class="string">"#imgUrl"</span>).val() == <span class="string">""</span>) &#123;</div><div class="line">                alert(<span class="string">"保存成功"</span>);</div><div class="line">                <span class="built_in">window</span>.location.href = <span class="string">"usercenter.html"</span>;</div><div class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> &#123;</div><div class="line">                $.ajax(&#123;</div><div class="line">                    url: uploadUrl,</div><div class="line">                    type: <span class="string">"POST"</span>,</div><div class="line">                    data: <span class="built_in">JSON</span>.stringify(uploadData),</div><div class="line">                    contentType: <span class="string">'application/json'</span>,</div><div class="line">                    success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">                        <span class="keyword">if</span> (data.success) &#123;</div><div class="line">                            alert(<span class="string">"保存成功"</span>);</div><div class="line">                            <span class="built_in">window</span>.location.href = <span class="string">"usercenter.html"</span>;</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125;)</div><div class="line">            &#125;</div><div class="line">        &#125;();</div></pre></td></tr></table></figure>
<h1 id="Web应用上传图片"><a href="#Web应用上传图片" class="headerlink" title="Web应用上传图片"></a>Web应用上传图片</h1><h2 id="后台接收数据格式为：multipart"><a href="#后台接收数据格式为：multipart" class="headerlink" title="后台接收数据格式为：multipart/*"></a>后台接收数据格式为：multipart/*</h2><h2 id="HTML代码-1"><a href="#HTML代码-1" class="headerlink" title="HTML代码"></a>HTML代码</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">"avatar-teacher"</span> <span class="attr">ng-controller</span>=<span class="string">"StudentAvatarCtrl"</span> <span class="attr">class</span>=<span class="string">"pos-r"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"avatar-teacher"</span> <span class="attr">class</span>=<span class="string">"pos-a top-200"</span>/&gt;</span>                     </div><div class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">ng-click</span>=<span class="string">"readAvatar()"</span> <span class="attr">ng-show</span>=<span class="string">"currentUser.photo==null"</span> <span class="attr">class</span>=<span class="string">"avatar"</span> <span class="attr">ng-src</span>=<span class="string">"&#123;&#123;avatarSource&#125;&#125;"</span>/&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">ng-click</span>=<span class="string">"readAvatar()"</span> <span class="attr">ng-show</span>=<span class="string">"currentUser.photo!=null"</span> <span class="attr">class</span>=<span class="string">"avatar"</span></span></div><div class="line">                                     <span class="attr">src</span>=<span class="string">"/VPFile&#123;&#123;currentUser.photo&#125;&#125;"</span>/&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">label</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="添加监听器"><a href="#添加监听器" class="headerlink" title="添加监听器"></a>添加监听器</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$scope.readAvatar = <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</div><div class="line"></div><div class="line">                <span class="keyword">var</span> file = <span class="built_in">document</span>.getElementById(<span class="string">'avatar-teacher'</span>);</div><div class="line">                <span class="keyword">if</span> (<span class="keyword">typeof</span> FileReader === <span class="string">'undefined'</span>) &#123;</div><div class="line">                    result.innerHTML = <span class="string">"抱歉，你的浏览器不支持 FileReader"</span>;</div><div class="line">                    input.setAttribute(<span class="string">'disabled'</span>, <span class="string">'disabled'</span>);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    file.addEventListener(<span class="string">'change'</span>, readFile, <span class="literal">false</span>);</div><div class="line">                &#125;</div><div class="line">            &#125;;</div></pre></td></tr></table></figure>
<h2 id="读取文件并上传"><a href="#读取文件并上传" class="headerlink" title="读取文件并上传"></a>读取文件并上传</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFile</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> file = <span class="keyword">this</span>.files[<span class="number">0</span>];</div><div class="line">                <span class="keyword">var</span> fd = <span class="keyword">new</span> FormData();</div><div class="line">                fd.append( <span class="string">"file"</span>, <span class="keyword">this</span>.files[<span class="number">0</span>]);</div><div class="line"></div><div class="line">                <span class="keyword">var</span> reqUpload = &#123;</div><div class="line">                    method: <span class="string">'POST'</span>,</div><div class="line">                    url: <span class="string">'服务器地址'</span>,</div><div class="line">                    <span class="comment">//transformRequest: angular.identity,</span></div><div class="line">                    headers: &#123;</div><div class="line">                        <span class="string">'Access-Token'</span>: localStorage[<span class="string">'accessToken'</span>],</div><div class="line">                        <span class="string">'Content-Type'</span>: <span class="literal">undefined</span></div><div class="line">                    &#125;,</div><div class="line">                    data: fd</div><div class="line"></div><div class="line">                &#125;;</div><div class="line"></div><div class="line">                $http(reqUpload).success(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</div><div class="line">                    <span class="comment">//do something you want to do</span></div><div class="line"></div><div class="line">                &#125;);</div><div class="line"></div><div class="line">                <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</div><div class="line">                reader.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">                    <span class="comment">// 通过 reader.result 来访问生成的 DataURL</span></div><div class="line">                    <span class="keyword">var</span> url = reader.result;</div><div class="line">                    $scope.avatarSource = url;</div><div class="line">                    $scope.$apply();<span class="comment">//让页面显示最新上传的图片</span></div><div class="line">                &#125;;</div><div class="line">                reader.readAsDataURL(file);</div><div class="line">            &#125;</div></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ol>
<li>有空去好好学学canvas吧,满有用的。。。</li>
<li>学完canvas估计H5上传图片的问题会有更深入的了解，而且图片剪裁应该也不是问题了。</li>
<li>还是要好好学习啊，不要总任性。</li>
</ol>

  </section>

  
  

<section class="post-comments">

    <div class="ds-thread" data-thread-key="blog/2016/02/25/H5上传图片/"></div>

    <script type="text/javascript">
      var duoshuoQuery = {short_name:"lijingjing"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
    </script> 

</section>


</article>

            <footer class="footer">

    <span class="footer__copyright">  &copy; 2016 阿菁菁菁菁菁 | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a></span>

</footer>

        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>


    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
