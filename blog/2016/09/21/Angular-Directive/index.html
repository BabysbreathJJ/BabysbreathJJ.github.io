<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      阿菁菁菁菁菁 | 阿菁菁菁菁菁
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="阿菁菁菁菁菁">
    
    

    <meta name="description" content="AngularJS Directive实践">
<meta property="og:type" content="article">
<meta property="og:title" content="阿菁菁菁菁菁 | 阿菁菁菁菁菁">
<meta property="og:url" content="http://lijingjing.top/blog/2016/09/21/Angular-Directive/index.html">
<meta property="og:site_name" content="阿菁菁菁菁菁">
<meta property="og:description" content="AngularJS Directive实践">
<meta property="og:image" content="http://lijingjing.top/images/Cadillac_config.png">
<meta property="og:image" content="http://lijingjing.top/images/Cadillac1.jpeg">
<meta property="og:image" content="http://lijingjing.top/images/Cadillac2.jpeg">
<meta property="og:image" content="http://lijingjing.top/images/Cadillac3.jpeg">
<meta property="og:updated_time" content="2016-11-29T08:45:23.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="阿菁菁菁菁菁 | 阿菁菁菁菁菁">
<meta name="twitter:description" content="AngularJS Directive实践">
<meta name="twitter:image" content="http://lijingjing.top/images/Cadillac_config.png">

    
    
      <link rel="icon" type="image/x-icon" href="/images/avatar.png">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">


</head>
<body>

    
      <header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">


    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        
        <a href="/" title="link to homepage for 阿菁菁菁菁菁"><img src="/images/avatar.png" width="100" alt="阿菁菁菁菁菁 logo" class="panel-cover__logo logo" /></a>
        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">阿菁菁菁菁菁</a></h1>
        <hr class="panel-cover__divider" />

        
        <h2 class="panel-cover__description panel-description-small">
          Change takes time.
        </h2>
        <hr class="panel-cover__divider panel-cover__divider--secondary" />
        

        <div class="navigation-wrapper">


        <nav class="cover-navigation cover-navigation--primary">
          <ul class="navigation">
            
              
              <li class="navigation__item"><a href="/blog" title="" class="blog-button">文章</a></li>
            
              
              <li class="navigation__item"><a href="/archive" title="" class="">归档</a></li>
            
              
              <li class="navigation__item"><a href="/about" title="" class="">关于我</a></li>
            

          </ul>
        </nav>

      <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->



<nav class="cover-navigation navigation--social">
  <ul class="navigation">

    
      <!-- Github -->
      <li class="navigation__item">
        <a href="https://github.com/BabysbreathJJ" title="阿菁 on GitHub">
          <i class='icon icon-social-github'></i>
          <span class="label">GitHub</span>
        </a>
      </li>
      <li class="navigation__item">
        <a href="mailto:lijingjing1008@gmail.com" title="阿菁‘s e-mail">
          <i class='icon icon-mail'></i>
          <span class="label">Mail</span>
        </a>
      </li>
      <li class="navigation__item">
        <a href="http://weibo.com/2797656002/profile" title="阿菁 on Weibo">
          <i class='icon cs-icon-weibo'></i>
          <span class="label">Weibo</span>
        </a>
      </li>
    

    <!-- China social icon -->
    <!--

      <li class="navigation__item">
        <a href="" title="">
          <i class='icon cs-icon-douban'></i>
          <span class="label">Douban</span>
        </a>
      </li>



    -->



  </ul>
</nav>




      <nav class="cover-navigation cover-navigation--primary">
        Friends:
        <ul class="navigation">
          
            <li class="navigation__item"><a href="http://gaocegege.com/Blog" title="" class="">高策</a></li>
          
            <li class="navigation__item"><a href="http://yusiyuan.top/" title="" class="">虞思源</a></li>
          
            <li class="navigation__item"><a href="http://lizheming.top/" title="" class="">黎哲明</a></li>
          

        </ul>
      </nav>


        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

      <span class="mobile btn-mobile-menu">
          <i class="icon icon-list btn-mobile-menu__icon"></i>
          <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
      </span>
      <div class="content-wrapper">
          <div class="content-wrapper__inner entry">
              

<article class="post-container post-container--single">

  <header class="post-header">

    <h1 class="post-title">利用Angular Directive实现树形结构</h1>

    

    <div class="post-meta">
      <time datetime="2016-09-21" class="post-meta__date date">2016-09-21</time>

      <span class="post-meta__tags tags">
          
            <font class="categories">
            &#8226; 分类:
            <a class="categories-link" href="/categories/AngularJS/">AngularJS</a>
            </font>
          

          
             &#8226; 标签:
            <font class="tags">
              <a class="tags-link" href="/tags/Directive/">Directive</a>
            </font>
          
        </span>
     </div>
    

  </header>

  <section id="post-content" class="article-content post">
    <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p> 在做Cadillac的项目时，由于网页端开发要参照媒设老师给的设计图，具体如下： <img src="/images/Cadillac_config.png" alt="Cadillac_config">  我也不清楚是否有现成的插件可以用，感觉应该要自己实现，而且由于自己一直很排斥angular中的指令，觉着好难，为了拯救我自己，所以就逼着自己去学习directive并运用到现有的开发项目中。</p>
<p> 其实我的实现代码本身还是很混乱的，因为点击编辑经常出现没有反应的现象，这个bug好像有时候可以复现，有时候不能复现，而且我一直想总结directive方面的东西，但因为拖延症没有总结。总之，由于bug的飘忽性，我终于决定写一篇关于directive的博客，希望梳理思路的过程中可以找到代码的漏洞，同时整理一下我自己都不想多看的代码。</p>
<h1 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h1><h2 id="html文件"><a href="#html文件" class="headerlink" title="html文件"></a>html文件</h2><p> 我本来想车系、配置和颜色各占一栏，这样均分三份就好了。但是由于配置由车系决定，颜色又由配置决定，这种从属关系太复杂，我发现如果我让他们各自独立成三块，不能方便的进行通信，因为每个directive有自己独立的scope，如果兄弟节点之间想要通信，必须借助于父亲，先把消息$emit给父亲，再通过父亲$broadcast给所有的孩子，特定的孩子再进行消息处理。这样我觉着逻辑太复杂，所以就设计了下面的指令形式。</p>
<p> 所有代码如下所示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">container</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">configinfo</span> <span class="attr">ng-repeat</span>=<span class="string">"carline in lines"</span>&gt;</span>      </div><div class="line">            <span class="tag">&lt;<span class="name">carline</span> <span class="attr">class</span>=<span class="string">"carline"</span> <span class="attr">line-name</span>=<span class="string">"carline.name"</span> <span class="attr">line-id</span>=<span class="string">"carline.id"</span> <span class="attr">edit</span>=<span class="string">"edit"</span></span></div><div class="line">                     <span class="attr">line-checked</span>=<span class="string">"carline.flag"</span>&gt;</div><div class="line">            <span class="tag">&lt;/<span class="name">carline</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6 col-xs-12"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-show</span>=<span class="string">"showConfigs"</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">configs</span> <span class="attr">ng-repeat</span>=<span class="string">"config in configs"</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">config</span> <span class="attr">class</span>=<span class="string">"config width-p50"</span> <span class="attr">config-name</span>=<span class="string">"config.name"</span></span></div><div class="line">                                <span class="attr">config-id</span>=<span class="string">"config.id"</span> <span class="attr">carline-id</span>=<span class="string">"carline.id"</span></div><div class="line">                                <span class="attr">config-checked</span>=<span class="string">"config.flag"</span>&gt;</div><div class="line">                        <span class="tag">&lt;/<span class="name">config</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"width-p50"</span> <span class="attr">ng-show</span>=<span class="string">"showColors"</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-repeat</span>=<span class="string">"color in colors"</span>&gt;</span></div><div class="line">                                <span class="tag">&lt;<span class="name">color</span> <span class="attr">class</span>=<span class="string">"color"</span> <span class="attr">config-id</span>=<span class="string">"config.id"</span> <span class="attr">color-name</span>=<span class="string">"color.name"</span></span></div><div class="line">                                       <span class="attr">color-id</span>=<span class="string">"color.id"</span> <span class="attr">color-checked</span>=<span class="string">"color.flag"</span>&gt;</div><div class="line">                                <span class="tag">&lt;/<span class="name">color</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">configs</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-xs-6 col-md-3"</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!-- 为了对齐操作那一栏 --&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">configinfo</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">container</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="JS文件"><a href="#JS文件" class="headerlink" title="JS文件"></a>JS文件</h2><h3 id="container"><a href="#container" class="headerlink" title="container"></a>container</h3><p> 其中，container是整个控件的容器，是下面所有指令的父亲，一些页面的控制可以写在container的控制器里；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//directives</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">containerFunc</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        restrict: <span class="string">'EA'</span>,</div><div class="line">        replace: <span class="literal">true</span>,</div><div class="line">        transclude: <span class="literal">true</span>,</div><div class="line">        template: <span class="string">'&lt;div ng-transclude&gt;&lt;/div&gt;'</span>,</div><div class="line">        controller: <span class="function"><span class="keyword">function</span> (<span class="params">$scope</span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> carlines = [];<span class="comment">//这里获取所有车系的scope，以方便之后判断哪个车系要展开</span></div><div class="line">            <span class="keyword">var</span> colors = [];</div><div class="line">            <span class="keyword">var</span> configs = [];</div><div class="line"></div><div class="line">            <span class="keyword">this</span>.gotConfigOpened = <span class="function"><span class="keyword">function</span> (<span class="params">selectedCarline</span>) </span>&#123;</div><div class="line">              <span class="comment">//刚开始没有选中的车系时，哪个配置都不展开</span></div><div class="line">                <span class="keyword">if</span> (selectedCarline == <span class="literal">undefined</span>) &#123;</div><div class="line">                    angular.forEach(carlines, <span class="function"><span class="keyword">function</span> (<span class="params">carline</span>) </span>&#123;</div><div class="line">                      <span class="comment">//让所有的配置项的icon都为加号</span></div><div class="line">                        carline.$broadcast(<span class="string">'showConfig'</span>, <span class="literal">false</span>);</div><div class="line">                        <span class="comment">//将所有配置项都收起</span></div><div class="line">                        carline.showConfigs = <span class="literal">false</span>;</div><div class="line"></div><div class="line">                    &#125;);</div><div class="line">                &#125;</div><div class="line">                <span class="comment">//根据点击获取车系的id,令当前车系下的配置展开</span></div><div class="line">                <span class="keyword">else</span> &#123;</div><div class="line">                    angular.forEach(carlines, <span class="function"><span class="keyword">function</span> (<span class="params">carline</span>) </span>&#123;</div><div class="line">                        <span class="keyword">if</span> (selectedCarline.lineid != carline.carline.id) &#123;</div><div class="line">                          <span class="comment">//让所有的配置项的icon都为加号</span></div><div class="line">                            carline.$broadcast(<span class="string">'showConfig'</span>, <span class="literal">false</span>);</div><div class="line">                            <span class="comment">//将所有配置项都收起</span></div><div class="line">                            carline.showConfigs = <span class="literal">false</span>;</div><div class="line">                        &#125;</div><div class="line">                        <span class="keyword">else</span> &#123;</div><div class="line">                          <span class="comment">//根据当前点击icon的状态来判断配置是否为收起状态</span></div><div class="line">                            carline.showConfigs = selectedCarline.showConfig;</div><div class="line">                            carline.$emit(<span class="string">'configs'</span>, selectedCarline.lineid);</div><div class="line"></div><div class="line">                        &#125;</div><div class="line">                    &#125;);</div><div class="line">                &#125;</div><div class="line"></div><div class="line"></div><div class="line">            <span class="keyword">this</span>.gotColorOpened = <span class="function"><span class="keyword">function</span> (<span class="params">selectedConfig</span>) </span>&#123;</div><div class="line">               angular.forEach(configs, <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</div><div class="line">                   <span class="keyword">if</span> (selectedConfig.configid != config.config.id) &#123;</div><div class="line">                       config.$broadcast(<span class="string">'showColor'</span>, <span class="literal">false</span>);</div><div class="line">                       config.showColors = <span class="literal">false</span>;</div><div class="line">                       config.$emit(<span class="string">'showColors'</span>, <span class="literal">false</span>);</div><div class="line">                   &#125;</div><div class="line">                   <span class="keyword">else</span> &#123;</div><div class="line">                       config.showColors = selectedConfig.showColor;</div><div class="line">                       config.$emit(<span class="string">'showColors'</span>, selectedConfig.showColor);</div><div class="line">                       config.$emit(<span class="string">'colors'</span>, selectedConfig.configid);</div><div class="line"></div><div class="line">                   &#125;</div><div class="line">               &#125;);</div><div class="line">           &#125;;</div><div class="line"></div><div class="line">                <span class="comment">//车系下的配置展开，所有的颜色信息收起</span></div><div class="line">                $scope.colors = [];</div><div class="line">                $scope.$broadcast(<span class="string">'showColor'</span>, <span class="literal">false</span>);</div><div class="line">                $scope.showColors = <span class="literal">false</span>;</div><div class="line">                $scope.$emit(<span class="string">'showColors'</span>, <span class="literal">false</span>);</div><div class="line"></div><div class="line">            &#125;;</div><div class="line"></div><div class="line">            <span class="keyword">this</span>.addCarLine = <span class="function"><span class="keyword">function</span> (<span class="params">carline</span>) </span>&#123;</div><div class="line">                carlines.push(carline);</div><div class="line">            &#125;;</div><div class="line"></div><div class="line">            <span class="keyword">this</span>.addConfig = <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</div><div class="line">               configs.push(config);</div><div class="line">           &#125;;</div><div class="line"></div><div class="line">            <span class="keyword">this</span>.addColor = <span class="function"><span class="keyword">function</span> (<span class="params">color</span>) </span>&#123;</div><div class="line">                colors.push(color);</div><div class="line">            &#125;;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="configinfo"><a href="#configinfo" class="headerlink" title="configinfo"></a>configinfo</h3><p> configinfo用来拿到车系信息，作为下层指令的父亲，所有的孩子都可以获取车系的相关信息；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">configinfoFunc</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        restrict: <span class="string">'EA'</span>,</div><div class="line">        replace: <span class="literal">true</span>,</div><div class="line">        transclude: <span class="literal">true</span>,</div><div class="line">        <span class="built_in">require</span>: <span class="string">'^?container'</span>,</div><div class="line">        template: <span class="string">'&lt;div class="row configinfo" ng-transclude&gt;&lt;/div&gt;'</span>,</div><div class="line">        link: <span class="function"><span class="keyword">function</span> (<span class="params">scope, element, attrs, containerController</span>) </span>&#123;</div><div class="line">          <span class="comment">//将当前车系的scope加入到父亲控制器的变量中，为之后配置的展开与收起做准备</span></div><div class="line">            containerController.addCarLine(scope);</div><div class="line">            scope.$on(<span class="string">'showColors'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, data</span>) </span>&#123;</div><div class="line">                scope.showColors = data;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="carline"><a href="#carline" class="headerlink" title="carline"></a>carline</h3><p> carline为具体的车系指令，显示车系，并在编辑状态下，显示前面的复选框，这样来让操作人员控制哪些车系现在可以放到系统里进行售卖；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">carlineFunc</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        restrict: <span class="string">'EA'</span>,</div><div class="line">        replace: <span class="literal">true</span>,</div><div class="line">        transclude: <span class="literal">true</span>,</div><div class="line">        <span class="built_in">require</span>: <span class="string">'^?container'</span>,</div><div class="line">        scope: &#123;<span class="comment">//传递信息给当前作用域</span></div><div class="line">            linename: <span class="string">'=lineName'</span>,</div><div class="line">            lineid: <span class="string">'=lineId'</span>,</div><div class="line">            carlineChecked: <span class="string">'=lineChecked'</span>,</div><div class="line">            edit: <span class="string">'=edit'</span></div><div class="line">        &#125;,</div><div class="line">        template: <span class="string">'&lt;div class="col-md-3 col-xs-6"&gt;'</span> +</div><div class="line">        <span class="string">'&lt;div class="checkbox" ng-show="edit"&gt;'</span> +</div><div class="line">        <span class="string">'&lt;label class="custom-checkbox"&gt;'</span> +</div><div class="line">        <span class="string">'&lt;input type="checkbox"  ng-model="carlineChecked" ng-change="lineChange(carlineChecked,lineid)"&gt;'</span> +</div><div class="line">        <span class="string">'&lt;span&gt;&#123;&#123;linename&#125;&#125;&lt;/span&gt;&lt;/label&gt; &lt;/div&gt;&lt;span ng-show="!edit"&gt;&#123;&#123;linename&#125;&#125;&lt;/span&gt;'</span> +</div><div class="line">        <span class="string">'&lt;i class="ion-ios-plus-outline addIcon config-icon" ng-show="(!showConfig)&amp;&amp;edit" ng-transclude ng-click="toggle()"&gt;&lt;/i&gt;'</span> +</div><div class="line">        <span class="string">'&lt;i class="ion-chevron-left addIcon config-icon" ng-show="showConfig&amp;&amp;edit" ng-transclude ng-click="toggle()"&gt;&lt;/i&gt;'</span> +</div><div class="line">        <span class="string">'&lt;/div&gt;'</span>,</div><div class="line">        link: <span class="function"><span class="keyword">function</span> (<span class="params">scope, element, attrs, containerController</span>) </span>&#123;</div><div class="line">          <span class="comment">//标志位，用来判断，当前后面的信息是否展开</span></div><div class="line">          <span class="comment">//如果为true，说明后面的配置项已经展开，图标为小于号</span></div><div class="line">          <span class="comment">//如果为false，说明后面的配置项收起，图标为加号</span></div><div class="line">            scope.showConfig = <span class="literal">false</span>;</div><div class="line"></div><div class="line">            scope.$on(<span class="string">'edit'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, data</span>) </span>&#123;</div><div class="line">                scope.edit = data;</div><div class="line">                scope.showConfig = <span class="literal">false</span>;</div><div class="line">                <span class="comment">//点击编辑，强制将所有项都收起，恢复初始状态</span></div><div class="line">                containerController.gotConfigOpened(<span class="literal">undefined</span>);</div><div class="line">            &#125;);</div><div class="line"></div><div class="line">            <span class="comment">//获取当前是否被勾选，然后发送消息给父亲scope，进行之后的信息保存</span></div><div class="line">            scope.lineChange = <span class="function"><span class="keyword">function</span> (<span class="params">carlineChecked, lineId</span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> data = &#123;id: lineId, flag: carlineChecked&#125;;</div><div class="line">                scope.$emit(<span class="string">'lineChange'</span>, data);</div><div class="line">            &#125;;</div><div class="line"></div><div class="line">            <span class="comment">//接收showConfig消息</span></div><div class="line">            scope.$on(<span class="string">'showConfig'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, data</span>) </span>&#123;</div><div class="line">                scope.showConfig = data;</div><div class="line">            &#125;);</div><div class="line"></div><div class="line">            scope.toggle = <span class="function"><span class="keyword">function</span> <span class="title">toggle</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                scope.showConfig = !scope.showConfig;</div><div class="line">                containerController.gotConfigOpened(scope);</div><div class="line">            &#125;;</div><div class="line"></div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="configs"><a href="#configs" class="headerlink" title="configs"></a>configs</h3><p> configs用来获取所有的配置信息，并将所有配置的scope存放到container中，即最外层指令中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">configsFunc</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        restrict: <span class="string">'EA'</span>,</div><div class="line">        replace: <span class="literal">true</span>,</div><div class="line">        transclude: <span class="literal">true</span>,</div><div class="line">        <span class="built_in">require</span>: <span class="string">'^?container'</span>,</div><div class="line">        template: <span class="string">'&lt;div class="row configinfo" ng-transclude&gt;&lt;/div&gt;'</span>,</div><div class="line">        link: <span class="function"><span class="keyword">function</span> (<span class="params">scope, element, attrs, containerController</span>) </span>&#123;</div><div class="line">            containerController.addConfig(scope);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="config"><a href="#config" class="headerlink" title="config"></a>config</h3><p> config为具体某个配置。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">configFunc</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        restrict: <span class="string">'EA'</span>,</div><div class="line">        replace: <span class="literal">true</span>,</div><div class="line">        transclude: <span class="literal">true</span>,</div><div class="line">        <span class="built_in">require</span>: <span class="string">'^?container'</span>,</div><div class="line">        scope: &#123;</div><div class="line">            configname: <span class="string">'=configName'</span>,</div><div class="line">            configid: <span class="string">'=configId'</span>,</div><div class="line">            carlineid: <span class="string">'=carlineId'</span>,</div><div class="line">            configChecked: <span class="string">'=configChecked'</span></div><div class="line">        &#125;,</div><div class="line">        template: <span class="string">'&lt;div class="config"&gt;'</span> +</div><div class="line">        <span class="string">'&lt;div class="checkbox"&gt;'</span> +</div><div class="line">        <span class="string">'&lt;label class="custom-checkbox"&gt;'</span> +</div><div class="line">        <span class="string">'&lt;input type="checkbox"  ng-model="configChecked" ng-change="configChange(configChecked,configid)"&gt;'</span> +</div><div class="line">        <span class="string">'&lt;span&gt;&#123;&#123;configname&#125;&#125;&lt;/span&gt;&lt;/label&gt; &lt;/div&gt;'</span> +</div><div class="line">        <span class="string">'&lt;i class="ion-ios-plus-outline config-icon" ng-show="!showColor" ng-transclude ng-click="toggle()"&gt;&lt;/i&gt;'</span> +</div><div class="line">        <span class="string">'&lt;i class="ion-chevron-left config-icon" ng-show="showColor" ng-transclude ng-click="toggle()"&gt;&lt;/i&gt;'</span> +</div><div class="line">        <span class="string">'&lt;/div&gt;'</span>,</div><div class="line">        link: <span class="function"><span class="keyword">function</span> (<span class="params">scope, element, attrs, containerController</span>) </span>&#123;</div><div class="line">            scope.showColor = <span class="literal">false</span>;</div><div class="line">            scope.$on(<span class="string">'showColor'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, data</span>) </span>&#123;</div><div class="line">                scope.showColor = data;</div><div class="line">            &#125;);</div><div class="line"></div><div class="line">            scope.toggle = <span class="function"><span class="keyword">function</span> <span class="title">toggle</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                scope.showColor = !scope.showColor;</div><div class="line">                containerController.gotColorOpened(scope);</div><div class="line">            &#125;;</div><div class="line"></div><div class="line">            scope.configChange = <span class="function"><span class="keyword">function</span> (<span class="params">configChecked, configId</span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> data = &#123;id: configId, flag: configChecked&#125;;</div><div class="line">                scope.$emit(<span class="string">'configChange'</span>, data);</div><div class="line">            &#125;;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="color"><a href="#color" class="headerlink" title="color"></a>color</h3><p> color为某个具体车系下的所有颜色。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">colorFunc</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        restrict: <span class="string">'EA'</span>,</div><div class="line">        replace: <span class="literal">true</span>,</div><div class="line">        transclude: <span class="literal">true</span>,</div><div class="line">        <span class="built_in">require</span>: <span class="string">'^?container'</span>,</div><div class="line">        scope: &#123;</div><div class="line">            colorname: <span class="string">'=colorName'</span>,</div><div class="line">            colorid: <span class="string">'=colorId'</span>,</div><div class="line">            configid: <span class="string">'=configId'</span>,</div><div class="line">            colorChecked: <span class="string">'=colorChecked'</span></div><div class="line">        &#125;,</div><div class="line">        template: <span class="string">'&lt;div class="color"&gt;'</span> +</div><div class="line">        <span class="string">'&lt;div class="checkbox"&gt;'</span> +</div><div class="line">        <span class="string">'&lt;label class="custom-checkbox"&gt;'</span> +</div><div class="line">        <span class="string">'&lt;input type="checkbox" id="checkboxWarning" ng-model="colorChecked" ng-change="colorChange(colorid,colorChecked)"&gt;'</span> +</div><div class="line">        <span class="string">'&lt;span&gt;&#123;&#123;colorname&#125;&#125;&lt;/span&gt;'</span> +</div><div class="line">        <span class="string">'&lt;/label&gt; &lt;/div&gt;'</span>,</div><div class="line">        link: <span class="function"><span class="keyword">function</span> (<span class="params">scope, element, attrs, containerController</span>) </span>&#123;</div><div class="line">            containerController.addColor(scope);</div><div class="line">            scope.colorChange = <span class="function"><span class="keyword">function</span> (<span class="params">id, flag</span>) </span>&#123;</div><div class="line">                <span class="keyword">var</span> data = &#123;id: id, flag: flag&#125;;</div><div class="line">                scope.$emit(<span class="string">'colorChange'</span>, data);</div><div class="line">            &#125;;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="数据缓存"><a href="#数据缓存" class="headerlink" title="数据缓存"></a>数据缓存</h3><p> 如果每次展开和收起都要重新去服务器拉取数据，这样是网络延迟比较高的情况下，用户体验是很差的，所以，可以把第一次获取的数据缓存到当前页面中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//ctrl</span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">ConfigInfoCtrl</span>(<span class="params">$scope, $filter, ConfigInfoService, $state, $stateParams</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> submitLines = [];</div><div class="line">    <span class="keyword">var</span> submitConfigs = [];</div><div class="line">    <span class="keyword">var</span> submitColors = [];</div><div class="line"></div><div class="line">    <span class="keyword">var</span> tempConfigs = [];</div><div class="line">    <span class="keyword">var</span> tempColors = [];</div><div class="line"></div><div class="line"></div><div class="line">    $scope.$on(<span class="string">'configs'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, lineId</span>) </span>&#123;</div><div class="line">        $scope.configs = [];</div><div class="line">        <span class="keyword">if</span> (tempConfigs[lineId] == <span class="literal">null</span> || tempConfigs[lineId] == <span class="literal">undefined</span>) &#123;</div><div class="line"></div><div class="line">            ConfigInfoService.getConfigs(lineId).success(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">                $scope.configs = data.data;</div><div class="line">                tempConfigs[lineId] = data.data;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            $scope.configs = tempConfigs[lineId];</div><div class="line"></div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    $scope.$on(<span class="string">'colors'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, configId</span>) </span>&#123;</div><div class="line">        $scope.colors = [];</div><div class="line">        <span class="keyword">if</span> (tempColors[configId] == <span class="literal">null</span> || tempColors[configId] == <span class="literal">undefined</span>) &#123;</div><div class="line">            ConfigInfoService.getColors(configId).success(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">                $scope.colors = data.data;</div><div class="line">                tempColors[configId] = data.data;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            $scope.colors = tempColors[configId];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    ConfigInfoService.getLines().success(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">        $scope.lines = data.data;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    $scope.$on(<span class="string">'lineChange'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, data</span>) </span>&#123;</div><div class="line">        submitLines.push(data);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    $scope.$on(<span class="string">'configChange'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, data</span>) </span>&#123;</div><div class="line">        submitConfigs.push(data);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    $scope.$on(<span class="string">'colorChange'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d, data</span>) </span>&#123;</div><div class="line">        submitColors.push(data);</div><div class="line">    &#125;);</div><div class="line">    $scope.edit = <span class="literal">false</span>;</div><div class="line"></div><div class="line">    $scope.startEdit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">        $scope.edit = <span class="literal">true</span>;</div><div class="line">        $scope.$broadcast(<span class="string">'edit'</span>, <span class="literal">true</span>);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    $scope.cancelEdit = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        submitLines = [];</div><div class="line">        submitConfigs = [];</div><div class="line">        submitColors = [];</div><div class="line"></div><div class="line">        tempConfigs = [];</div><div class="line"></div><div class="line">        tempColors = [];</div><div class="line">        $scope.edit = <span class="literal">false</span>;</div><div class="line">        $scope.$broadcast(<span class="string">'edit'</span>, <span class="literal">false</span>);</div><div class="line">        $scope.$broadcast(<span class="string">'showColor'</span>, <span class="literal">false</span>);</div><div class="line">        $scope.$broadcast(<span class="string">'showConfig'</span>, <span class="literal">false</span>);</div><div class="line">        ConfigInfoService.getLines().success(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">            $scope.lines = data.data;</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    $scope.updateConfig = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">var</span> params = &#123;line: submitLines, configuration: submitConfigs, color: submitColors&#125;;</div><div class="line"></div><div class="line">        ConfigInfoService.updateConfigs(<span class="built_in">JSON</span>.stringify(params)).success(<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</div><div class="line">            $scope.edit = <span class="literal">false</span>;</div><div class="line">            $scope.$broadcast(<span class="string">'edit'</span>, <span class="literal">false</span>);</div><div class="line">            alert(<span class="string">"提交成功!"</span>);</div><div class="line">        &#125;);</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="实现结果"><a href="#实现结果" class="headerlink" title="实现结果"></a>实现结果</h1><p><img src="/images/Cadillac1.jpeg" alt="Cadillac_config"><br><img src="/images/Cadillac2.jpeg" alt="Cadillac_config"><br><img src="/images/Cadillac3.jpeg" alt="Cadillac_config">   </p>

  </section>

  
  

<section class="post-comments">

    <div class="ds-thread" data-thread-key="blog/2016/09/21/Angular-Directive/"></div>

    <script type="text/javascript">
      var duoshuoQuery = {short_name:"lijingjing"};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
        || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
    </script> 

</section>


</article>

              <footer class="footer">

    <span class="footer__copyright">  &copy; 2017 阿菁菁菁菁菁 | 由<a href="https://hexo.io/">Hexo</a>强力驱动 | 主题<a href="https://github.com/someus/huno">Huno</a></span>

</footer>

          </div>
      </div>

    



    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>


    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
